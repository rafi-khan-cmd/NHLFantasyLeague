<mat-card class="scenario-builder-card">
  <mat-card-header class="card-header">
    <div class="header-content">
      <mat-icon class="header-icon">build_circle</mat-icon>
      <div>
        <mat-card-title>Build Supply Chain Scenario</mat-card-title>
        <mat-card-subtitle>Create custom scenarios to simulate supply chain impacts</mat-card-subtitle>
      </div>
    </div>
  </mat-card-header>
  <mat-card-content>
    <form [formGroup]="scenarioForm" (ngSubmit)="onSubmit()">
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Scenario Name</mat-label>
        <input matInput formControlName="name" required>
      </mat-form-field>

      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Description</mat-label>
        <textarea matInput formControlName="description" rows="3" required></textarea>
      </mat-form-field>

      <div class="section-header">
        <mat-icon>schedule</mat-icon>
        <h3>Supplier Delays</h3>
      </div>
      <div formArrayName="supplierDelays">
        <div *ngFor="let delay of supplierDelays.controls; let i = index" [formGroupName]="i" class="form-row">
          <mat-form-field appearance="outline">
            <mat-label>Supplier ID</mat-label>
            <input matInput formControlName="supplierId" required>
          </mat-form-field>
          <mat-form-field appearance="outline">
            <mat-label>Supplier Name</mat-label>
            <input matInput formControlName="supplierName" required>
          </mat-form-field>
          <mat-form-field appearance="outline">
            <mat-label>Delay Days</mat-label>
            <input matInput type="number" formControlName="delayDays" required>
          </mat-form-field>
          <mat-form-field appearance="outline">
            <mat-label>Start Date</mat-label>
            <input matInput type="date" formControlName="startDate" required>
          </mat-form-field>
          <mat-form-field appearance="outline">
            <mat-label>End Date</mat-label>
            <input matInput type="date" formControlName="endDate" required>
          </mat-form-field>
          <button mat-icon-button type="button" (click)="removeSupplierDelay(i)">
            <mat-icon>delete</mat-icon>
          </button>
        </div>
      </div>
      <button mat-raised-button color="accent" type="button" (click)="addSupplierDelay()" class="add-button">
        <mat-icon>add_circle</mat-icon>
        <span>Add Supplier Delay</span>
      </button>

      <div class="section-header">
        <mat-icon>trending_up</mat-icon>
        <h3>Demand Spikes</h3>
      </div>
      <div formArrayName="demandSpikes">
        <div *ngFor="let spike of demandSpikes.controls; let i = index" [formGroupName]="i" class="form-row">
          <mat-form-field appearance="outline">
            <mat-label>Product ID</mat-label>
            <input matInput formControlName="productId" required>
          </mat-form-field>
          <mat-form-field appearance="outline">
            <mat-label>Product Name</mat-label>
            <input matInput formControlName="productName" required>
          </mat-form-field>
          <mat-form-field appearance="outline">
            <mat-label>Percentage Increase</mat-label>
            <input matInput type="number" formControlName="percentageIncrease" required>
          </mat-form-field>
          <mat-form-field appearance="outline">
            <mat-label>Start Date</mat-label>
            <input matInput type="date" formControlName="startDate" required>
          </mat-form-field>
          <mat-form-field appearance="outline">
            <mat-label>End Date</mat-label>
            <input matInput type="date" formControlName="endDate" required>
          </mat-form-field>
          <button mat-icon-button type="button" (click)="removeDemandSpike(i)">
            <mat-icon>delete</mat-icon>
          </button>
        </div>
      </div>
      <button mat-raised-button color="accent" type="button" (click)="addDemandSpike()" class="add-button">
        <mat-icon>add_circle</mat-icon>
        <span>Add Demand Spike</span>
      </button>

      <div class="section-header">
        <mat-icon>inventory</mat-icon>
        <h3>Inventory Adjustments</h3>
      </div>
      <div formArrayName="inventoryAdjustments">
        <div *ngFor="let adjustment of inventoryAdjustments.controls; let i = index" [formGroupName]="i" class="form-row">
          <mat-form-field appearance="outline">
            <mat-label>Product ID</mat-label>
            <input matInput formControlName="productId" required>
          </mat-form-field>
          <mat-form-field appearance="outline">
            <mat-label>Product Name</mat-label>
            <input matInput formControlName="productName" required>
          </mat-form-field>
          <mat-form-field appearance="outline">
            <mat-label>Adjustment Quantity</mat-label>
            <input matInput type="number" formControlName="adjustmentQuantity" required>
          </mat-form-field>
          <mat-form-field appearance="outline">
            <mat-label>Type</mat-label>
            <mat-select formControlName="adjustmentType" required>
              <mat-option value="increase">Increase</mat-option>
              <mat-option value="decrease">Decrease</mat-option>
            </mat-select>
          </mat-form-field>
          <button mat-icon-button type="button" (click)="removeInventoryAdjustment(i)">
            <mat-icon>delete</mat-icon>
          </button>
        </div>
      </div>
      <button mat-raised-button color="accent" type="button" (click)="addInventoryAdjustment()" class="add-button">
        <mat-icon>add_circle</mat-icon>
        <span>Add Inventory Adjustment</span>
      </button>

      <div class="form-actions">
        <button mat-raised-button color="primary" type="submit" [disabled]="isSubmitting" class="submit-button">
          <mat-icon *ngIf="!isSubmitting">check_circle</mat-icon>
          <mat-spinner *ngIf="isSubmitting" diameter="20" style="display: inline-block; margin-right: 8px;"></mat-spinner>
          <span>{{ isSubmitting ? 'Creating...' : 'Create Scenario' }}</span>
        </button>
      </div>
    </form>
  </mat-card-content>
</mat-card>

<mat-card *ngIf="submittedScenarios.length > 0" style="margin-top: 20px;">
  <mat-card-header>
    <mat-card-title>Created Scenarios</mat-card-title>
  </mat-card-header>
  <mat-card-content>
    <mat-table [dataSource]="submittedScenarios">
      <ng-container matColumnDef="name">
        <mat-header-cell *matHeaderCellDef>Name</mat-header-cell>
        <mat-cell *matCellDef="let scenario">{{ scenario.name }}</mat-cell>
      </ng-container>
      <ng-container matColumnDef="description">
        <mat-header-cell *matHeaderCellDef>Description</mat-header-cell>
        <mat-cell *matCellDef="let scenario">{{ scenario.description }}</mat-cell>
      </ng-container>
      <ng-container matColumnDef="status">
        <mat-header-cell *matHeaderCellDef>Status</mat-header-cell>
        <mat-cell *matCellDef="let scenario">{{ scenario.status || 'Draft' }}</mat-cell>
      </ng-container>
      <mat-header-row *matHeaderRowDef="['name', 'description', 'status']"></mat-header-row>
      <mat-row *matRowDef="let row; columns: ['name', 'description', 'status']"></mat-row>
    </mat-table>
  </mat-card-content>
</mat-card>

